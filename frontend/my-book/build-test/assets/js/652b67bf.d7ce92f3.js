"use strict";(globalThis.webpackChunkmy_book=globalThis.webpackChunkmy_book||[]).push([[8537],{6987:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"chapters/module1-communication","title":"ROS 2 Communication Patterns","description":"Overview","source":"@site/docs/chapters/module1-communication.md","sourceDirName":"chapters","slug":"/chapters/module1-communication","permalink":"/docs/chapters/module1-communication","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"sanastudent","lastUpdatedAt":1765131832000,"frontMatter":{},"sidebar":"bookSidebar","previous":{"title":"ROS 2 Architecture and Design Patterns","permalink":"/docs/chapters/module1-architecture"},"next":{"title":"ROS 2 Practical Implementation","permalink":"/docs/chapters/module1-practice"}}');var i=r(4848),t=r(8453);const l={},a="ROS 2 Communication Patterns",o={},c=[{value:"Overview",id:"overview",level:2},{value:"1. Topics (Publish-Subscribe)",id:"1-topics-publish-subscribe",level:2},{value:"When to Use",id:"when-to-use",level:3},{value:"Example: Publishing Camera Images",id:"example-publishing-camera-images",level:3},{value:"Subscribing to Topics",id:"subscribing-to-topics",level:3},{value:"Quality of Service (QoS)",id:"quality-of-service-qos",level:2},{value:"Reliability",id:"reliability",level:3},{value:"Durability",id:"durability",level:3},{value:"History",id:"history",level:3},{value:"2. Services (Request-Response)",id:"2-services-request-response",level:2},{value:"When to Use",id:"when-to-use-1",level:3},{value:"Example: Add Two Numbers",id:"example-add-two-numbers",level:3},{value:"3. Actions (Goal-Based)",id:"3-actions-goal-based",level:2},{value:"When to Use",id:"when-to-use-2",level:3},{value:"Example: Navigate to Goal",id:"example-navigate-to-goal",level:3},{value:"Choosing the Right Pattern",id:"choosing-the-right-pattern",level:2},{value:"Exercise: Temperature Alert System",id:"exercise-temperature-alert-system",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"ros-2-communication-patterns",children:"ROS 2 Communication Patterns"})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"ROS 2 provides three primary communication patterns, each suited for different use cases."}),"\n",(0,i.jsx)(n.h2,{id:"1-topics-publish-subscribe",children:"1. Topics (Publish-Subscribe)"}),"\n",(0,i.jsx)(n.h3,{id:"when-to-use",children:"When to Use"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Continuous data streams (sensor data, state updates)"}),"\n",(0,i.jsx)(n.li,{children:"One-to-many communication"}),"\n",(0,i.jsx)(n.li,{children:"Fire-and-forget messaging"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"example-publishing-camera-images",children:"Example: Publishing Camera Images"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from sensor_msgs.msg import Image\r\nfrom cv_bridge import CvBridge\r\nimport cv2\r\n\r\nclass CameraPublisher(Node):\r\n    def __init__(self):\r\n        super().__init__('camera_publisher')\r\n\r\n        # Create publisher with QoS\r\n        self.publisher = self.create_publisher(\r\n            Image,\r\n            '/camera/image_raw',\r\n            10  # Queue size\r\n        )\r\n\r\n        self.bridge = CvBridge()\r\n        self.timer = self.create_timer(0.033, self.publish_frame)\r\n        self.cap = cv2.VideoCapture(0)\r\n\r\n    def publish_frame(self):\r\n        ret, frame = self.cap.read()\r\n        if ret:\r\n            msg = self.bridge.cv2_to_imgmsg(frame, \"bgr8\")\r\n            msg.header.stamp = self.get_clock().now().to_msg()\r\n            msg.header.frame_id = \"camera_optical_frame\"\r\n            self.publisher.publish(msg)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"subscribing-to-topics",children:"Subscribing to Topics"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class ImageSubscriber(Node):\r\n    def __init__(self):\r\n        super().__init__('image_subscriber')\r\n\r\n        self.subscription = self.create_subscription(\r\n            Image,\r\n            '/camera/image_raw',\r\n            self.image_callback,\r\n            10\r\n        )\r\n\r\n    def image_callback(self, msg):\r\n        self.get_logger().info(\r\n            f'Received image: {msg.width}x{msg.height}'\r\n        )\r\n        # Process the image...\n"})}),"\n",(0,i.jsx)(n.h2,{id:"quality-of-service-qos",children:"Quality of Service (QoS)"}),"\n",(0,i.jsx)(n.p,{children:"QoS policies control message delivery behavior:"}),"\n",(0,i.jsx)(n.h3,{id:"reliability",children:"Reliability"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Reliable"}),": Guarantees delivery (TCP-like)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Best Effort"}),": May drop messages (UDP-like)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"durability",children:"Durability"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Transient Local"}),": Cache last message for late joiners"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Volatile"}),": Only send to current subscribers"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"history",children:"History"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Keep Last"}),": Store last N messages"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Keep All"}),": Store all messages (until limit)"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from rclpy.qos import QoSProfile, ReliabilityPolicy, DurabilityPolicy\r\n\r\n# Define custom QoS\r\nqos_profile = QoSProfile(\r\n    reliability=ReliabilityPolicy.RELIABLE,\r\n    durability=DurabilityPolicy.TRANSIENT_LOCAL,\r\n    depth=10\r\n)\r\n\r\npublisher = node.create_publisher(\r\n    Image,\r\n    '/camera/image',\r\n    qos_profile\r\n)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"2-services-request-response",children:"2. Services (Request-Response)"}),"\n",(0,i.jsx)(n.h3,{id:"when-to-use-1",children:"When to Use"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Occasional requests with responses"}),"\n",(0,i.jsx)(n.li,{children:"Synchronous operations"}),"\n",(0,i.jsx)(n.li,{children:"Configuration or command execution"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"example-add-two-numbers",children:"Example: Add Two Numbers"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Define Service"})," (",(0,i.jsx)(n.code,{children:"AddTwoInts.srv"}),"):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"int64 a\r\nint64 b\r\n---\r\nint64 sum\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Service Server"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from example_interfaces.srv import AddTwoInts\r\n\r\nclass AdditionServer(Node):\r\n    def __init__(self):\r\n        super().__init__('addition_server')\r\n\r\n        self.srv = self.create_service(\r\n            AddTwoInts,\r\n            'add_two_ints',\r\n            self.add_callback\r\n        )\r\n\r\n    def add_callback(self, request, response):\r\n        response.sum = request.a + request.b\r\n        self.get_logger().info(\r\n            f'{request.a} + {request.b} = {response.sum}'\r\n        )\r\n        return response\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Service Client"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class AdditionClient(Node):\r\n    def __init__(self):\r\n        super().__init__('addition_client')\r\n\r\n        self.client = self.create_client(\r\n            AddTwoInts,\r\n            'add_two_ints'\r\n        )\r\n\r\n        while not self.client.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info('Waiting for service...')\r\n\r\n    def send_request(self, a, b):\r\n        request = AddTwoInts.Request()\r\n        request.a = a\r\n        request.b = b\r\n\r\n        future = self.client.call_async(request)\r\n        return future\n"})}),"\n",(0,i.jsx)(n.h2,{id:"3-actions-goal-based",children:"3. Actions (Goal-Based)"}),"\n",(0,i.jsx)(n.h3,{id:"when-to-use-2",children:"When to Use"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Long-running tasks with feedback"}),"\n",(0,i.jsx)(n.li,{children:"Cancelable operations"}),"\n",(0,i.jsx)(n.li,{children:"Progress monitoring"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"example-navigate-to-goal",children:"Example: Navigate to Goal"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Action Definition"})," (",(0,i.jsx)(n.code,{children:"NavigateToGoal.action"}),"):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# Goal\r\ngeometry_msgs/PoseStamped target_pose\r\n---\r\n# Result\r\nbool success\r\nfloat32 final_distance\r\n---\r\n# Feedback\r\ngeometry_msgs/PoseStamped current_pose\r\nfloat32 distance_remaining\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Action Server"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from nav_msgs.action import NavigateToGoal\r\nfrom rclpy.action import ActionServer\r\n\r\nclass NavigationServer(Node):\r\n    def __init__(self):\r\n        super().__init__('navigation_server')\r\n\r\n        self._action_server = ActionServer(\r\n            self,\r\n            NavigateToGoal,\r\n            'navigate_to_goal',\r\n            self.execute_callback\r\n        )\r\n\r\n    def execute_callback(self, goal_handle):\r\n        self.get_logger().info('Executing navigation...')\r\n\r\n        feedback_msg = NavigateToGoal.Feedback()\r\n\r\n        # Simulate navigation\r\n        for i in range(10):\r\n            if goal_handle.is_cancel_requested:\r\n                goal_handle.canceled()\r\n                return NavigateToGoal.Result()\r\n\r\n            # Update feedback\r\n            feedback_msg.distance_remaining = 10.0 - i\r\n            goal_handle.publish_feedback(feedback_msg)\r\n            time.sleep(0.5)\r\n\r\n        goal_handle.succeed()\r\n        result = NavigateToGoal.Result()\r\n        result.success = True\r\n        result.final_distance = 0.0\r\n        return result\n"})}),"\n",(0,i.jsx)(n.h2,{id:"choosing-the-right-pattern",children:"Choosing the Right Pattern"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Pattern"}),(0,i.jsx)(n.th,{children:"Use Case"}),(0,i.jsx)(n.th,{children:"Example"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Topic"})}),(0,i.jsx)(n.td,{children:"Continuous data"}),(0,i.jsx)(n.td,{children:"Sensor readings, robot state"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Service"})}),(0,i.jsx)(n.td,{children:"Quick request/response"}),(0,i.jsx)(n.td,{children:"Get configuration, toggle mode"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Action"})}),(0,i.jsx)(n.td,{children:"Long task with feedback"}),(0,i.jsx)(n.td,{children:"Navigation, grasping, planning"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"exercise-temperature-alert-system",children:"Exercise: Temperature Alert System"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Task"}),": Build a system with all three patterns:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Topic"}),": Publish temperature readings"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Service"}),": Set temperature threshold"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Action"}),": Run cooling sequence when threshold exceeded"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2713 Mastered pub-sub pattern with topics"}),"\n",(0,i.jsx)(n.li,{children:"\u2713 Understood QoS policies"}),"\n",(0,i.jsx)(n.li,{children:"\u2713 Implemented services for request-response"}),"\n",(0,i.jsx)(n.li,{children:"\u2713 Created actions for long-running tasks"}),"\n",(0,i.jsx)(n.li,{children:"\u2713 Learned when to use each pattern"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Next chapter covers practical implementations!"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Image Placeholder"}),": [Communication patterns diagram]"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Citation"}),': ROS 2 Documentation. "About Quality of Service Settings." ',(0,i.jsx)(n.a,{href:"https://docs.ros.org",children:"docs.ros.org"})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>a});var s=r(6540);const i={},t=s.createContext(i);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);